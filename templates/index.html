<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>King County Survival Guide – Harbor &amp; Vale LLC (Demo)</title>
  <style>
    :root {
      --brand-primary: #1E4B7A; /* deep blue */
      --brand-accent: #CFAE70;  /* warm gold */
    }
    body{font-family:system-ui,Arial,sans-serif;max-width:720px;margin:24px auto;padding:0 16px;line-height:1.45;color:#222}
    header{display:flex;align-items:center;gap:12px;margin-bottom:16px}
    h1{margin:0;color:var(--brand-primary)}
    .pill{font-size:12px;border:1px solid #ddd;border-radius:999px;padding:4px 10px}
    .card{border:1px solid #eee;border-radius:12px;padding:16px;margin:12px 0;box-shadow:0 2px 8px rgba(0,0,0,.04)}
    button{padding:10px 14px;border-radius:10px;border:1px solid #ddd;cursor:pointer;background:var(--brand-accent);color:#fff;border:none}
    button:hover{opacity:.9}
    input,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #ddd}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .row > *{flex:1 1 200px}
    .muted{color:#666;margin:0}
    footer{margin-top:28px;font-size:12px;color:#777}
    code{background:#f7f7f7;padding:2px 6px;border-radius:6px}
    #output{white-space:pre-wrap}
  </style>
</head>
<body>
  <header>
    <div>
      <h1>King County Survival Guide</h1>
      <p class="muted">by Harbor &amp; Vale LLC</p>
    </div>
    <span class="pill">Demo • Tier 1–3 skeleton</span>
  </header>

  <div class="card">
    <h2>Quick Actions</h2>
    <div class="row">
      <button onclick="loadServices()">See Nearby Services</button>
<button onclick="triage('I need housing')">AI: I need housing</button>
<button onclick="triage('I need medical')">AI: I need medical</button>
    </div>
    <p class="muted">These call demo endpoints to show flow. No real data yet.</p>
  <div id="cards"></div>
<pre id="output" class="card" style="display:none"></pre>


  </div>

  <div class="card">
    <h2>Contact / Intake (Demo)</h2>
    <form id="demoForm" onsubmit="submitForm(event)">
      <div class="row">
        <input name="name" placeholder="Your name (optional)" />
        <input name="need" placeholder="What do you need? (e.g., housing, ID, meal)" />
      </div>
      <textarea name="details" rows="3" placeholder="Add any details you'd like…"></textarea>
      <div style="margin-top:12px">
        <button type="submit">Submit</button>
      </div>
    </form>
    <p class="muted">Sends a demo POST to <code>/submit_form</code> and shows a success message.</p>
  </div>

  <footer>
    © Harbor &amp; Vale LLC — demo for conversations & testing. No confidential info; call 211 for emergencies.
  </footer>

<script>
  // Show debug output (and make it visible if hidden)
  const out = (data) => {
    const el = document.getElementById('output');
    if (el) {
      el.style.display = 'block';
      el.textContent = JSON.stringify(data, null, 2);
    }
  };

  // Surface any JavaScript errors to the page (so nothing fails silently)
  window.onerror = function(msg, src, line, col, err){
    out({ js_error: String(msg), src, line, col, stack: err && err.stack });
    return false;
  };

  // Render service "cards" with Call / Website / Directions
  function renderCards(list){
    const el = document.getElementById('cards');
    if (!el) { out({error:"Missing #cards container"}); return; }
    if (!Array.isArray(list)) { out({error:"Expected array", got: typeof list}); return; }

    el.innerHTML = list.map(s => {
      const maps = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.address || s.name)}`;
      const tel  = s.phone ? `tel:${s.phone.replace(/[^+\d]/g,'')}` : null;
      return `
        <div class="card">
          <h3>${s.name}</h3>
          <p class="muted">${s.type || ''} • ${s.neighborhood || 'Seattle'} • ${s.hours || ''}</p>
          ${s.notes ? `<p>${s.notes}</p>` : ''}
          <div class="row">
            ${tel ? `<a href="${tel}"><button>Call</button></a>` : ''}
            ${s.website ? `<a target="_blank" rel="noopener" href="${s.website}"><button>Website</button></a>` : ''}
            <a target="_blank" rel="noopener" href="${maps}"><button>Directions</button></a>
          </div>
        </div>
      `;
    }).join('');
  }

  // Load services and render as cards
  async function loadServices(){
    try{
      const res = await fetch('/services');
      const data = await res.json();
      renderCards(data);
    }catch(e){
      out({ error: String(e) });
    }
  }

  // Keep the AI triage with robust JSON handling
  async function triage(message){
    try{
      const res = await fetch('/ai_triage', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ message })
      });
      const txt = await res.text();
      try {
        const data = JSON.parse(txt);
        out(data);
      } catch (parseErr) {
        out({ error: String(parseErr), status: res.status, raw: txt.slice(0, 300) });
      }
    } catch(e){
      out({ error: String(e) });
    }
  }

  // Demo form submit
  async function submitForm(e){
    e.preventDefault();
    const form = new FormData(document.getElementById('demoForm'));
    const res = await fetch('/submit_form',{ method:'POST', body: form });
    out(await res.json());
  }
</script>

</body>
</html>
