<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>King County Survival Guide – Harbor &amp; Vale LLC (Demo)</title>
  <style>
  /* Vaporwave-ish palette */
  :root {
    --brand-bg-1: #0b0c1e;      /* deep indigo */
    --brand-bg-2: #1a1540;      /* purple midnight */
    --brand-card: rgba(255,255,255,0.06);
    --brand-border: rgba(255,255,255,0.12);
    --brand-text: #f2f2f7;      /* near-white */
    --brand-muted: #b8b8d9;     /* muted violet-gray */
    --brand-primary: #7d5fff;   /* neon purple */
    --brand-accent: #ff71ce;    /* neon pink */
    --brand-cyan: #01cdfe;      /* neon cyan */
    --shadow: 0 8px 28px rgba(0,0,0,.35);
  }

  html, body { height: 100%; }
  body{
    font-family: system-ui, Arial, sans-serif;
    color: var(--brand-text);
    background: radial-gradient(1200px 800px at 20% -10%, #2a1b59 0%, transparent 60%),
                radial-gradient(1000px 700px at 120% 20%, #0b3d91 0%, transparent 55%),
                linear-gradient(180deg, var(--brand-bg-1) 0%, var(--brand-bg-2) 100%);
    max-width: 900px;
    margin: 24px auto;
    padding: 0 16px;
    line-height: 1.5;
  }

  h1, h2, h3 { color: var(--brand-text); }
  .muted{ color: var(--brand-muted); }

  .pill{
    font-size:12px;
    border:1px solid var(--brand-border);
    border-radius:999px;
    padding:4px 10px;
    color: var(--brand-muted);
    background: var(--brand-card);
    backdrop-filter: blur(6px);
  }

  .card{
    border:1px solid var(--brand-border);
    border-radius:14px;
    padding:16px;
    margin:12px 0;
    background: var(--brand-card);
    box-shadow: var(--shadow);
  }

  button{
    padding:10px 14px;
    border-radius:12px;
    border:1px solid var(--brand-border);
    cursor:pointer;
    background: linear-gradient(135deg, var(--brand-accent), var(--brand-cyan));
    color:#0b0c1e;
    font-weight:600;
  }
  button:hover{ filter: brightness(1.05); }
  button:active{ transform: translateY(1px); }

  input,textarea{
    width:100%;
    padding:10px;
    border-radius:10px;
    border:1px solid var(--brand-border);
    background: rgba(255,255,255,0.06);
    color: var(--brand-text);
  }

  .row{ display:flex; gap:12px; flex-wrap:wrap }
  .row > *{ flex:1 1 200px }

  code{ background: rgba(255,255,255,0.08); padding:2px 6px; border-radius:6px; color: var(--brand-cyan); }
  #output{ white-space: pre-wrap; }
    .hero { position: relative; }
.glow {
  position: absolute;
  left: 50%;
  top: -20px;
  transform: translateX(-50%);
  width: 520px; height: 180px;
  background:
    radial-gradient(closest-side, var(--brand-accent), transparent 60%),
    radial-gradient(closest-side, var(--brand-cyan),   transparent 65%);
  filter: blur(40px);
  opacity: .35;
  pointer-events: none;
  z-index: 0;
}
    .hero { position: relative; }
.glow {
  position: absolute;
  left: 50%;
  top: -20px;
  transform: translateX(-50%);
  width: 520px; height: 180px;
  background:
    radial-gradient(closest-side, var(--brand-accent), transparent 60%),
    radial-gradient(closest-side, var(--brand-cyan),   transparent 65%);
  filter: blur(40px);
  opacity: .35;
  pointer-events: none;
  z-index: 0;
}

</style>

</head>
<body>
  <div class="hero">
  <div class="glow"></div>
  <header style="display:flex;align-items:center;gap:12px;margin-bottom:16px;position:relative;z-index:1">
    <img src="{{ url_for('static', filename='logo.png') }}" alt="Harbor &amp; Vale LLC" style="height:56px;width:auto;">
    <div>
      <h1 style="margin:0">King County Survival Guide</h1>
      <p class="muted" style="margin:0">by Harbor &amp; Vale LLC</p>
    </div>
    <span class="pill" style="margin-left:auto">Demo • Tier 1–3 skeleton</span>
  </header>
</div>


  <div class="card">
    <h2>Quick Actions</h2>
    <div class="row">
      <button onclick="loadServicesFiltered('Clinic')">Clinics</button>
<button onclick="loadServicesFiltered('Shelter')">Shelters</button>
      <button onclick="loadServices()">See Nearby Services</button>
<button onclick="triage('I need housing')">AI: I need housing</button>
<button onclick="triage('I need medical')">AI: I need medical</button>
    </div>
    <p class="muted">These call demo endpoints to show flow. No real data yet.</p>
  <div id="cards"></div>
<pre id="output" class="card" style="display:none"></pre>


  </div>

  <div class="card">
    <h2>Contact / Intake (Demo)</h2>
    <form id="demoForm" onsubmit="submitForm(event)">
      <div class="row">
        <input name="name" placeholder="Your name (optional)" />
        <input name="need" placeholder="What do you need? (e.g., housing, ID, meal)" />
      </div>
      <textarea name="details" rows="3" placeholder="Add any details you'd like…"></textarea>
      <div style="margin-top:12px">
        <button type="submit">Submit</button>
      </div>
    </form>
    <p class="muted">Sends a demo POST to <code>/submit_form</code> and shows a success message.</p>
  </div>

  <footer>
    © Harbor &amp; Vale LLC — demo for conversations & testing. No confidential info; call 211 for emergencies.
  </footer>

<script>
  // Show debug output (and make it visible if hidden)
  const out = (data) => {
    const el = document.getElementById('output');
    if (el) {
      el.style.display = 'block';
      el.textContent = JSON.stringify(data, null, 2);
    }
  };

  // Surface any JavaScript errors to the page (so nothing fails silently)
  window.onerror = function(msg, src, line, col, err){
    out({ js_error: String(msg), src, line, col, stack: err && err.stack });
    return false;
  };

  // Render service "cards" with Call / Website / Directions
  function renderCards(list){
    const el = document.getElementById('cards');
    if (!el) { out({error:"Missing #cards container"}); return; }
    if (!Array.isArray(list)) { out({error:"Expected array", got: typeof list}); return; }

    el.innerHTML = list.map(s => {
      const maps = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.address || s.name)}`;
      const tel  = s.phone ? `tel:${s.phone.replace(/[^+\d]/g,'')}` : null;
      return `
        <div class="card">
          <h3>${s.name}</h3>
          <p class="muted">${s.type || ''} • ${s.neighborhood || 'Seattle'} • ${s.hours || ''}</p>
          ${s.notes ? `<p>${s.notes}</p>` : ''}
          <div class="row">
          <button onclick="loadServicesFiltered('Clinic')">Clinics</button>
<button onclick="loadServicesFiltered('Shelter')">Shelters</button>
            ${tel ? `<a href="${tel}"><button>Call</button></a>` : ''}
            ${s.website ? `<a target="_blank" rel="noopener" href="${s.website}"><button>Website</button></a>` : ''}
            <a target="_blank" rel="noopener" href="${maps}"><button>Directions</button></a>
          </div>
        </div>
      `;
    }).join('');
  }

  // Load services and render as cards
  async function loadServices(){
    try{
      const res = await fetch('/services');
      const data = await res.json();
      renderCards(data);
    }catch(e){
      out({ error: String(e) });
    }
  }
async function loadServicesFiltered(kind){
  try{
    const res = await fetch('/services?type=' + encodeURIComponent(kind));
    const data = await res.json();
    renderCards(data);
  }catch(e){
    out({ error: String(e) });
  }
}

  // Keep the AI triage with robust JSON handling
  async function triage(message){
    try{
      const res = await fetch('/ai_triage', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ message })
      });
      const txt = await res.text();
      try {
        const data = JSON.parse(txt);
        out(data);
      } catch (parseErr) {
        out({ error: String(parseErr), status: res.status, raw: txt.slice(0, 300) });
      }
    } catch(e){
      out({ error: String(e) });
    }
  }

  // Demo form submit
  async function submitForm(e){
    e.preventDefault();
    const form = new FormData(document.getElementById('demoForm'));
    const res = await fetch('/submit_form',{ method:'POST', body: form });
    out(await res.json());
  }
</script>

</body>
</html>
